From 55837a3129c60c3830f31daa05254567c62885ba Mon Sep 17 00:00:00 2001
From: "cheng.tang" <tangch318@gmail.com>
Date: Tue, 4 Jul 2017 17:31:33 +0800
Subject: [PATCH] Add query and fragment valid to url_path

Fixes: redmine #10435

Signed-off-by: cheng.tang <tangch318@gmail.com>
Signed-off-by: Hunt Xu <mhuntxu@gmail.com>
---
 neutron/services/loadbalancer/constants.py | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/neutron/services/loadbalancer/constants.py b/neutron/services/loadbalancer/constants.py
index 5e414fd43..b5649ece1 100644
--- a/neutron/services/loadbalancer/constants.py
+++ b/neutron/services/loadbalancer/constants.py
@@ -49,8 +49,14 @@ SUPPORTED_HTTP_METHODS = (HTTP_METHOD_GET, HTTP_METHOD_HEAD, HTTP_METHOD_POST,
 #         pct-encoded   = "%" HEXDIG HEXDIG
 #         sub-delims    = "!" / "$" / "&" / "'" / "(" / ")"
 #                         / "*" / "+" / "," / ";" / "="
+#         query = *( pchar / "/" / "?" )
+#         fragment = *( pchar / "/" / "?" )
+#
+PCHAR = "[a-zA-Z0-9-._~!$&\'()*+,;=:@]|(%[a-fA-F0-9]{2})"
 SUPPORTED_URL_PATH = (
-        "^(/([a-zA-Z0-9-._~!$&\'()*+,;=:@]|(%[a-fA-F0-9]{2}))*)+$")
+        "^(/(%s)*)+(\?((%s)|[/\?])*)?(#((%s)|[/\?])*)?$" % (
+            PCHAR, PCHAR, PCHAR
+        ))
 
 SESSION_PERSISTENCE_SOURCE_IP = 'SOURCE_IP'
 SESSION_PERSISTENCE_HTTP_COOKIE = 'HTTP_COOKIE'
-- 
2.11.0 (Apple Git-81)

